@model CodeWithMena.PerfumeShop.PL.ViewModels.POS.SaleInvoiceVm
@{
    ViewData["Title"] = "Invoice " + Model.InvoiceNumber;
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container" id="invoice">
    <div class="d-flex justify-content-between mb-4">
        <h1>Invoice</h1>
        <button type="button" class="btn btn-outline-primary" onclick="window.print();">Print</button>
    </div>
    <div class="card">
        <div class="card-body">
            <div class="row mb-3">
                <div class="col">
                    <strong>Invoice #</strong> @Model.InvoiceNumber<br />
                    <strong>Date</strong> @Model.SaleDateTime.ToString("yyyy-MM-dd HH:mm")
                </div>
            </div>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Company</th>
                        <th>Bottle</th>
                        <th class="text-end">Qty</th>
                        <th class="text-end">Unit Price</th>
                        <th class="text-end">Line Total</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.Items)
                    {
                        <tr>
                            <td>@item.NameSnapshot @(item.IsMixed ? "(Mix: " + item.MixCode + ")" : "")</td>
                            <td>@(item.ManufacturingCompanySnapshot ?? "-")</td>
                            <td>@item.BottleSize</td>
                            <td class="text-end">@item.Quantity</td>
                            <td class="text-end">@item.UnitPrice.ToString("N2")</td>
                            <td class="text-end">@item.LineTotal.ToString("N2")</td>
                        </tr>
                    }
                </tbody>
            </table>
            <div class="row justify-content-end">
                <div class="col-md-4">
                    <p><strong>Subtotal:</strong> @Model.Subtotal.ToString("N2") EGP</p>
                    @if (Model.DiscountPercent.HasValue && Model.DiscountPercent.Value > 0)
                    {
                        <p><strong>Discount (@Model.DiscountPercent%):</strong> @((Model.Subtotal - Model.TotalAfterDiscount).ToString("N2")) EGP</p>
                    }
                    else if (Model.DiscountAmount.HasValue && Model.DiscountAmount.Value > 0)
                    {
                        <p><strong>Discount:</strong> @Model.DiscountAmount.Value.ToString("N2") EGP</p>
                    }
                    <p><strong>Total:</strong> @Model.TotalAfterDiscount.ToString("N2") EGP</p>
                    @if (!string.IsNullOrEmpty(Model.PaymentMethod))
                    {
                        <p><strong>Payment:</strong> @Model.PaymentMethod</p>
                    }
                    @if (!string.IsNullOrEmpty(Model.Notes))
                    {
                        <p><strong>Notes:</strong> @Model.Notes</p>
                    }
                </div>
            </div>
        </div>
    </div>
    <div class="mt-3">
        <a asp-action="Create" class="btn btn-primary">New Sale</a>
    </div>
</div>

<style>
@@media print {
    .btn, nav, footer { display: none !important; }
}
</style>
